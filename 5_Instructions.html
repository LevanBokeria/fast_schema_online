<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0">
    <title>Instructions</title>	
	<script src="jspsych-6.3.1/jspsych.js" ></script>
	<script src='./jspsych-6.3.1/plugins/jspsych-instructions.js'></script>
	<script src='./jspsych-6.3.1/plugins/jspsych-html-slider-response.js'></script>
	<script src='./jspsych-6.3.1/plugins/jspsych-survey-multi-choice.js'></script>
	<script src="jatos.js"></script>
	<link rel="stylesheet" href="jspsych-6.3.1/css/jspsych.css" type="text/css"></link>
	<link rel="stylesheet" href="./extra_files/schema_online.css" type="text/css"></link>	
  </head>

  <body>
  <script>

		//start timeline
		jatos.onLoad(function() {

			jatos.studySessionData.inputData = {}

			//make a timeline
			let timeline =[]; 

			// Define pages for phase 1
			let instruction_pages = [			
				'<div class= "header">'+
					'<h1> Instructions </h1>'+
				'</div>'+	
				'<div class="instruct">'+
					'<p>Welcome to the session!</p>' + 
					'<p>On each trial, click the cell where you think the item is located. </p>' + 
				'</div>',																										
			];


			var condition_options = ["8/4 ver 1", "8/4 ver 2", "6/6 ver 1", "6/6 ver 2"];

			var condition_choice_page = {
			type: 'survey-multi-choice',
			questions: [
				{prompt: "Which condition do you want to run?", name: 'condition', options: condition_options, required:true}, 
			],
			};

			var n_training_ses_page = {
				type: 'html-slider-response',
				stimulus: '<p>Number of training sessions</p>',
				labels: ['1','2','3'],
				min: 1,
				max: 3,
				step: 1,
				slider_start: 3,
				prompt: "<p>Choose the number of TRAINING sessions </p>"
			};

			var n_testing_ses_page = {
				type: 'html-slider-response',
				stimulus: '<p>Number of testing sessions</p>',
				labels: ['1','2','3'],
				min: 1,
				max: 3,
				step: 1,
				slider_start: 1,
				prompt: "<p>Choose the number of TESTING sessions </p>"
			};

			var n_trials_per_pa = {
				type: 'html-slider-response',
				stimulus: '<p>Number of trials per PA</p>',
				labels: ['5','6','7','8','9','10','11','12','13','14','15'],
				min: 5,
				max: 15,
				step: 1,
				slider_start: 10,
				prompt: "<p>Choose the number trials per PA </p>"
			};			

			var trial_duration_page = {
				type: 'html-slider-response',
				stimulus: '<p>Trial duration</p>',
				// labels: ['500','750','1000', '1250','1500', '1750','2000', '2250','2500', '2750','3000', '3250','3500', '3750','4000'],
				labels: ['500','1000','1500','2000','2500','3000','3500','4000','4500','5000','5500','6000'],
				min: 500,
				max: 6000,
				step: 250,
				slider_start: 3000,
				prompt: "<p>Choose the duration of each trial</p>"
			};

			var feedback_duration_page = {
				type: 'html-slider-response',
				stimulus: '<p>Feedback duration</p>',
				// labels: ['0','100','200','300','400','500','600','700','800','900','1000'],
				labels: ['250','500','750','1000','1250','1500','1750','2000','2250','2500','2750','3000'],
				min: 250,
				max: 3000,
				step: 250,
				slider_start: 1000,
				prompt: "<p>Choose the duration for the feedback</p>"
			};		
			
			var iti_duration_page = {
				type: 'html-slider-response',
				stimulus: '<p>ITI duration</p>',
				// labels: ['100','200','300','400','500','600','700','800','900','1000'],
				labels: ['250','500','750','1000','1250','1500','1750','2000','2250','2500','2750','3000'],
				min: 250,
				max: 3000,
				step: 250,
				slider_start: 500,
				prompt: "<p>Choose the duration for ITI</p>"
			};			

			let instructions = {
				type: 'instructions',
				pages : instruction_pages,						
				show_clickable_nav: true,
				button_label_next: '<span style="color: black"d;> <strong> Next </stong></span>',
			};

			timeline.push(condition_choice_page);
			timeline.push(n_training_ses_page);
			timeline.push(n_testing_ses_page);
			timeline.push(n_trials_per_pa);
			timeline.push(trial_duration_page);
			timeline.push(feedback_duration_page);
			timeline.push(iti_duration_page);
			timeline.push(instructions);

			jsPsych.init({
				
				timeline: timeline,

				on_finish: function(data) {

					// Make JATOS remember that this session was run
                    jatos.studySessionData.latestFinishedComponentId    = jatos.componentId;
                    jatos.studySessionData.latestFinishedComponentPos   = jatos.componentPos;
                    jatos.studySessionData.latestFinishedComponentTitle = jatos.componentProperties.title;

					// Record results
					var results = jsPsych.data.get().values();

					debugger

					jatos.studySessionData.inputData.condition_to_run = results[0].response.condition

					jatos.studySessionData.inputData.n_ses_per_condition = {
						schema_learning: results[1].response,
						new_pa_learning: results[2].response,
					}

					jatos.studySessionData.inputData.n_trials_per_pa = {
						schema_learning: results[3].response,
						new_pa_learning: results[3].response,
					}

					jatos.studySessionData.inputData.trial_duration    = results[4].response
					jatos.studySessionData.inputData.feedback_duration = results[5].response
					jatos.studySessionData.inputData.iti_duration      = results[6].response

					jatos.submitResultData('[instructions_start_' + '---' + 
					JSON.stringify(jatos.studySessionData) +
					'---' + '_instructions_end]', 
					jatos.startNextComponent);

					// jsPsych.data.displayData();
				}
			});

		});


	</script>
</body>
</html>