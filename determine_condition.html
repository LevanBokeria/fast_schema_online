<!DOCTYPE html>
<html>
    <head>
        <title>Determine condition</title>
        <script src='jatos.js'></script>
        <script src='./jspsych-6.3.1/jspsych.js'></script>        
        <script src='./extra_functions/lodash.js'></script>
        <script src='./extra_functions/jspsych-playground.js'></script>
        <script src='./extra_functions/trial_creator.js'></script>
        <script src = './extra_functions/jquery-3.4.1.js' type='text/javascript'></script>
        <script src="./jspsych-6.3.1/plugins/jspsych-vsl-grid-scene.js"></script>
        <script src="./jspsych-6.3.1/plugins/jspsych-serial-reaction-time-mouse.js"></script>
        <script src="./extra_functions/board_creator.js"></script>
        <link href='./jspsych-6.3.1/css/jspsych.css' rel='stylesheet' type='text/css'></link>
        <link href='./extra_files/schema_online.css' rel='stylesheet' type='text/css'></link>
    </head>
    <body></body>
    <script>

        jatos.onLoad(function() {

            // Define all the conditions here ///////////////////////////////////////////////////////////
            // jatos.studySessionData.inputData = {}
            jatos.studySessionData.outputData = {}
            jatos.studySessionData.outputData.session_results = []

            jatos.studySessionData.inputData.curr_session = 0
            
            // Component positions
            jatos.studySessionData.inputData.component_positions = {
                session_pa: 4,
                break: 5,
                data_submission: 6,
            }

            jatos.studySessionData.inputData.curr_condition = ''

            // jatos.studySessionData.inputData.trial_dur = 3000
            // jatos.studySessionData.inputData.feedback_dur = 2000

            // Add the cells
            jatos.studySessionData.inputData.n_rows = 12
            jatos.studySessionData.inputData.n_cols = 12

            jatos.studySessionData.inputData.n_ses_total = {
                schema_learning: jatos.studySessionData.inputData.n_schema_ses_per_cond * 4,
                new_pa_learning: jatos.studySessionData.inputData.n_new_pa_ses_total = jatos.studySessionData.inputData.n_new_pa_ses_per_cond * 5
            }

            // Define all the possible colors. Later, map these by randomization or latin square
            jatos.studySessionData.inputData.condition_colors = {
                non_adj_8_4: 'red',
                adj_8_4: 'yellow',
                non_adj_6_6: 'blue',
                adj_6_6: 'green',
                raw_learning: 'gray',
            }

            jatos.studySessionData.inputData.condition_ses_counters = {

                non_adj_8_4: {
                    schema_learning: 0,
                    new_pa_learning: 0,
                },
                adj_8_4: {
                    schema_learning: 0,
                    new_pa_learning: 0,
                },
                non_adj_6_6: {
                    schema_learning: 0,
                    new_pa_learning: 0,
                },
                adj_6_6: {
                    schema_learning: 0,
                    new_pa_learning: 0,
                },
                raw_learning: {
                    schema_learning: 0,
                    new_pa_learning: 0,
                },
            }

            jatos.studySessionData.inputData.condition_coords = {
                non_adj_8_4: {

                    schema_learning: {
                        ses1: [
                            [8,2],
                            [2,5],
                            [5,5],
                            [8,5],
                            [2,8],
                            [8,8],
                            [11,8],
                            [5,11],
                        ],
                        ses2: [
                        [8,2],
                            [2,5],
                            [5,5],
                            [8,5],
                            [2,8],
                            [8,8],
                            [11,8],
                            [5,11],
                        ],
                        ses3: [
                        [8,2],
                            [2,5],
                            [5,5],
                            [8,5],
                            [2,8],
                            [8,8],
                            [11,8],
                            [5,11],
                        ],
                    },
                    new_pa_learning: {
                        ses1: [
                            [5,2],
                            [11,5],
                            [5,8],
                            [8,11],
                        ],        
                    },                          
                },
                adj_8_4: {
                    schema_learning: {
                        ses1: [
                            [4,2],
                            [9,3],
                            [2,5],
                            [6,6],
                            [10,6],
                            [5,8],
                            [4,10],
                            [9,10],
                        ],
                        ses2: [
                        [4,2],
                            [9,3],
                            [2,5],
                            [6,6],
                            [10,6],
                            [5,8],
                            [4,10],
                            [9,10],
                        ],
                        ses3: [
                        [4,2],
                            [9,3],
                            [2,5],
                            [6,6],
                            [10,6],
                            [5,8],
                            [4,10],
                            [9,10],
                        ],
                    },
                    new_pa_learning: {
                        ses1: [
                            [5,4],
                            [11,7],
                            [7,9],
                            [3,10],
                        ], 
                    },                          
                },
                non_adj_6_6: {
                    schema_learning: {
                        ses1: [
                            [5,2],
                            [2,5],
                            [8,5],
                            [5,8],
                            [5,11],
                            [8,11],                        
                        ],
                        ses2: [
                            [5,2],
                            [2,5],
                            [8,5],
                            [5,8],
                            [5,11],
                            [8,11], 
                        ],
                        ses3: [
                            [5,2],
                            [2,5],
                            [8,5],
                            [5,8],
                            [5,11],
                            [8,11], 
                        ],
                    },

                    new_pa_learning: {
                        ses1: [
                            [8,2],
                            [5,5],
                            [11,5],
                            [2,8],
                            [8,8],
                            [11,8],                        
                        ],     
                    },                          
                },
                adj_6_6: {
                    schema_learning: {
                        ses1: [
                            [6,3],
                            [9,4],
                            [3,6],
                            [6,7],
                            [10,9],
                            [6,10],                       
                        ],
                        ses2: [
                            [6,3],
                            [9,4],
                            [3,6],
                            [6,7],
                            [10,9],
                            [6,10],
                        ],
                        ses3: [
                            [6,3],
                            [9,4],
                            [3,6],
                            [6,7],
                            [10,9],
                            [6,10],
                        ],
                    },
                    new_pa_learning: {
                            ses1: [
                                [8,2],
                                [10,4],
                                [4,5],
                                [11,7],
                                [8,8],
                                [3,9],
                            ],
                    },
                },
                raw_learning: {
                    new_pa_learning: {
                        ses1: [
                            [5,2],
                            [5,8],
                            [8,8],
                        ],        
                    },    
                },
            }

            jatos.studySessionData.inputData.stimuli = {
                adj_6_6: {
                    schema_learning: [
                        'img/targets/BOSS/downsized/buffaloskull.jpg',
                        'img/targets/BOSS/downsized/bulldozer.jpg',
                        'img/targets/BOSS/downsized/bullet.jpg',
                        'img/targets/BOSS/downsized/bulletbelt.jpg',
                        'img/targets/BOSS/downsized/bun.jpg',
                        'img/targets/BOSS/downsized/butterfly.jpg',
                    ],
                    new_pa_learning: [
                        'img/targets/BOSS/downsized/cactus.jpg',
                        'img/targets/BOSS/downsized/callbell.jpg',
                        'img/targets/BOSS/downsized/campfire.jpg',
                        'img/targets/BOSS/downsized/candelabra.jpg',
                        'img/targets/BOSS/downsized/car.jpg',
                        'img/targets/BOSS/downsized/caribou02.jpg',
                    ]
                },
                non_adj_6_6: {
                    schema_learning: [
                        'img/targets/BOSS/downsized/bicycle.jpg',
                        'img/targets/BOSS/downsized/bikepump01.jpg',
                        'img/targets/BOSS/downsized/birdnest.jpg',
                        'img/targets/BOSS/downsized/blackbear.jpg',
                        'img/targets/BOSS/downsized/bolt01a.jpg',
                        'img/targets/BOSS/downsized/bottleofwhitewine.jpg',
                    ],
                    new_pa_learning: [
                        'img/targets/BOSS/downsized/bow.jpg',
                        'img/targets/BOSS/downsized/bowlingball.jpg',
                        'img/targets/BOSS/downsized/bowlingpin.jpg',
                        'img/targets/BOSS/downsized/bowtie.jpg',
                        'img/targets/BOSS/downsized/boxtruck.jpg',
                        'img/targets/BOSS/downsized/broadsword.jpg',
                    ]
                },
                adj_8_4: {
                    schema_learning: [
                        'img/targets/BOSS/downsized/artichoke01b.jpg',
                        'img/targets/BOSS/downsized/badmintonracket.jpg',
                        'img/targets/BOSS/downsized/ballofstring.jpg',
                        'img/targets/BOSS/downsized/barnowl.jpg',
                        'img/targets/BOSS/downsized/barrel01.jpg',
                        'img/targets/BOSS/downsized/basketball01.jpg',
                        'img/targets/BOSS/downsized/bassethound.jpg',
                        'img/targets/BOSS/downsized/battleaxe.jpg',
                    ],
                    new_pa_learning: [
                        'img/targets/BOSS/downsized/beachpaddle01a.jpg',
                        'img/targets/BOSS/downsized/beachumbrella01.jpg',
                        'img/targets/BOSS/downsized/bed.jpg',
                        'img/targets/BOSS/downsized/bench01.jpg',
                    ],
                },
                non_adj_8_4: {
                    schema_learning: [
                        'img/targets/BOSS/downsized/8ball.jpg',
                        'img/targets/BOSS/downsized/accordion01.jpg',
                        'img/targets/BOSS/downsized/aceofdiamond.jpg',
                        'img/targets/BOSS/downsized/acorn.jpg',
                        'img/targets/BOSS/downsized/acousticguitar02.jpg',
                        'img/targets/BOSS/downsized/addressplate.jpg',
                        'img/targets/BOSS/downsized/africanelephant.jpg',
                        'img/targets/BOSS/downsized/aloe01.jpg',                                             
                    ],
                    new_pa_learning: [
                        'img/targets/BOSS/downsized/americangoldfinch.jpg',
                        'img/targets/BOSS/downsized/anchor.jpg',
                        'img/targets/BOSS/downsized/ant.jpg',
                        'img/targets/BOSS/downsized/armchair02.jpg',
                    ]
                },
                raw_learning: {
                    new_pa_learning: [
                        'img/targets/BOSS/downsized/bicycle.jpg',
                        'img/targets/BOSS/downsized/bikepump01.jpg',
                        'img/targets/BOSS/downsized/birdnest.jpg',
                    ]
                }
            }            

            jatos.studySessionData.inputData.all_images = [
                'img/targets/BOSS/downsized/8ball.jpg',
                'img/targets/BOSS/downsized/accordion01.jpg',
                'img/targets/BOSS/downsized/aceofdiamond.jpg',
                'img/targets/BOSS/downsized/acorn.jpg',
                'img/targets/BOSS/downsized/acousticguitar02.jpg',
                'img/targets/BOSS/downsized/addressplate.jpg',
                'img/targets/BOSS/downsized/africanelephant.jpg',
                'img/targets/BOSS/downsized/aloe01.jpg',
                'img/targets/BOSS/downsized/americangoldfinch.jpg',
                'img/targets/BOSS/downsized/anchor.jpg',
                'img/targets/BOSS/downsized/ant.jpg',
                'img/targets/BOSS/downsized/armchair02.jpg',
                'img/targets/BOSS/downsized/artichoke01b.jpg',
                'img/targets/BOSS/downsized/badmintonracket.jpg',
                'img/targets/BOSS/downsized/ballofstring.jpg',
                'img/targets/BOSS/downsized/barnowl.jpg',
                'img/targets/BOSS/downsized/barrel01.jpg',
                'img/targets/BOSS/downsized/basketball01.jpg',
                'img/targets/BOSS/downsized/bassethound.jpg',
                'img/targets/BOSS/downsized/battleaxe.jpg',
                'img/targets/BOSS/downsized/beachpaddle01a.jpg',
                'img/targets/BOSS/downsized/beachumbrella01.jpg',
                'img/targets/BOSS/downsized/bed.jpg',
                'img/targets/BOSS/downsized/bench01.jpg',
                'img/targets/BOSS/downsized/bicycle.jpg',
                'img/targets/BOSS/downsized/bikepump01.jpg',
                'img/targets/BOSS/downsized/birdnest.jpg',
                'img/targets/BOSS/downsized/blackbear.jpg',
                'img/targets/BOSS/downsized/bolt01a.jpg',
                'img/targets/BOSS/downsized/bottleofwhitewine.jpg',
                'img/targets/BOSS/downsized/bow.jpg',
                'img/targets/BOSS/downsized/bowlingball.jpg',
                'img/targets/BOSS/downsized/bowlingpin.jpg',
                'img/targets/BOSS/downsized/bowtie.jpg',
                'img/targets/BOSS/downsized/boxtruck.jpg',
                'img/targets/BOSS/downsized/broadsword.jpg',
                'img/targets/BOSS/downsized/callbell.jpg',
                'img/targets/BOSS/downsized/buffaloskull.jpg',
                'img/targets/BOSS/downsized/bulldozer.jpg',
                'img/targets/BOSS/downsized/bullet.jpg',
                'img/targets/BOSS/downsized/bulletbelt.jpg',
                'img/targets/BOSS/downsized/bun.jpg',
                'img/targets/BOSS/downsized/butterfly.jpg',
                'img/targets/BOSS/downsized/cactus.jpg',
                'img/targets/BOSS/downsized/callbell.jpg',
                'img/targets/BOSS/downsized/campfire.jpg',
                'img/targets/BOSS/downsized/candelabra.jpg',
                'img/targets/BOSS/downsized/car.jpg',
                'img/targets/BOSS/downsized/caribou02.jpg',
                'img/targets/BOSS/downsized/carsidemirror01.jpg',
                'img/targets/BOSS/downsized/cartonofeggs.jpg',
                'img/targets/BOSS/downsized/castle.jpg',
                'img/targets/BOSS/downsized/cat.jpg',
                'img/targets/BOSS/downsized/centurionhelmet.jpg',
            ]

            debugger

            let key;

            if (jatos.studySessionData.inputData.condition_to_run == '8/4 ver 1'){
                key = 'adj_8_4'
            } else if (jatos.studySessionData.inputData.condition_to_run == '8/4 ver 2'){
                key = 'non_adj_8_4'
            } else if (jatos.studySessionData.inputData.condition_to_run == '6/6 ver 1'){
                key = 'adj_6_6'
            } else if (jatos.studySessionData.inputData.condition_to_run == '6/6 ver 2'){
                key = 'non_adj_6_6'
            }

            let cond_to_run = {}

            cond_to_run[key] = jatos.studySessionData.inputData.stimuli[key]

            // Create the trials
            jatos.studySessionData.inputData.all_sessions = trial_creator(cond_to_run)
   
            // ////////////////////////////////////////////////////////////////////////////////////////////
            // ////////////////////////////////////////////////////////////////////////////////////////////
            // Create save the sessions in jatos studySessionData.

            // Make JATOS remember that this session was run
            jatos.studySessionData.latestFinishedComponentId    = jatos.componentId;
            jatos.studySessionData.latestFinishedComponentPos   = jatos.componentPos;
            jatos.studySessionData.latestFinishedComponentTitle = jatos.componentProperties.title;

            // Input data gets lost for some reason???
            // jatos.studySessionData.inputData = JSON.parse(JSON.stringify(jatos.studySessionData.inputData))

            jatos.submitResultData("[conditions_start---" + 
            JSON.stringify(jatos.studySessionData) + "---conditions_end]", jatos.startNextComponent);

            // ///////////////////////////////////////////////////////////////////////////////////////////////
            //////////////////////////////////////////////////////////////////////////////////////////////////
        });
    
    </script>
</html>
