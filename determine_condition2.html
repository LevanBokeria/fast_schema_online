<!DOCTYPE html>
<html>
    <head>
        <title>Determine condition2</title>
        <script src='jatos.js'></script>
        <script src='./jspsych-6.3.1/jspsych.js'></script>        
        <script src='./extra_functions/lodash.js'></script>
        <script src='./extra_functions/jspsych-playground2.js'></script>
        <script src='./extra_functions/trial_creator2.js'></script>
        <script src='./extra_functions/math.js'></script>
        <script src = './extra_functions/jquery-3.4.1.js' type='text/javascript'></script>
        <script src="./jspsych-6.3.1/plugins/jspsych-serial-reaction-time-mouse.js"></script>
        <script src='./jspsych-6.3.1/plugins/jspsych-instructions.js'></script>
        <script src='./jspsych-6.3.1/plugins/jspsych-html-slider-response.js'></script>
        <script src='./jspsych-6.3.1/plugins/jspsych-survey-multi-choice.js'></script>
        <script src="./extra_functions/board_creator2.js"></script>
        <link href='./jspsych-6.3.1/css/jspsych.css' rel='stylesheet' type='text/css'></link>
        <link href='./extra_files/schema_online.css' rel='stylesheet' type='text/css'></link>
    </head>
    <body></body>
    <script>

    jatos.onLoad(function() {
        
        // Define all the conditions here ///////////////////////////////////////////////////////////
        var timeline = []

        jatos.studySessionData.inputData = {}
        jatos.studySessionData.outputData = {}
        jatos.studySessionData.outputData.session_results_schema_display = []
        jatos.studySessionData.outputData.session_results_new_pa_learning = []
        jatos.studySessionData.outputData.session_results_image_screen = []

        jatos.studySessionData.inputData.curr_session = 0
        
        // Component positions
        jatos.studySessionData.inputData.component_positions = {
            instructions: 3,
            session_pa: 4,            
            break: 5,            
            data_submission: 6,
            debriefing: 7,
            session_pa2: 9,
            break2: 10,
            debriefing2: 11,
        }

        jatos.studySessionData.inputData.curr_condition = ''

        // Add the cells
        jatos.studySessionData.inputData.n_rows = 12
        jatos.studySessionData.inputData.n_cols = 12

        // Define all the possible colors. Later, map these by randomization or latin square
        jatos.studySessionData.inputData.condition_colors = {
            practice: 'purple',
            schema_c: 'blue',
            schema_ic: 'green',
            landmark_schema: 'red',
            random_locations: 'yellow',            
            no_schema: 'gray',
        }

        jatos.studySessionData.inputData.condition_border_patterns = {
            practice: 'triangles',
            schema_c: 'circles',
            schema_ic: 'diamonds',
            random_locations: 'bullseye_larger',
            landmark_schema: 'bullsdiamond_larger',
            no_schema: 'stars_larger'
        }

        jatos.studySessionData.inputData.condition_ses_counters = {
            practice: 0,
            schema_ic: 0,
            schema_c: 0,
        }
        
        jatos.studySessionData.inputData.arrangement_coords = {
            arr_pair_1: {
                arr_pair_1_1: [
                            [6,3],
                            [9,4],
                            [3,6],
                            [7,7],
                            [10,9],
                            [5,10],
                        ],
                arr_pair_1_2: [
                            [8,2],
                            [10,4],
                            [4,5],
                            [11,7],
                            [8,8],
                            [3,9],
                    ],
            },
            arr_pair_2: {
                arr_pair_2_1: [
                            [6,2],
                            [2,3],
                            [8,5],
                            [4,8],
                            [9,10],
                            [3,11],                        
                        ],
                arr_pair_2_2: [
                            [10,2],
                            [3,4],
                            [7,5],
                            [9,7],
                            [2,9],
                            [8,9],                        
                        ], 
            },
            arr_pair_3: {
                arr_pair_3_1: [
                            [3,3],
                            [8,4],
                            [4,7],
                            [10,8],
                            [2,10],
                            [7,10],                        
                        ],
                arr_pair_3_2: [
                            [10,2],
                            [4,4],
                            [9,6],
                            [4,9],
                            [7,9],
                            [11,11],                        
                        ], 
            },
            arr_pair_4: {
                arr_pair_4_1: [
                            [9,2],
                            [5,3],
                            [8,5],
                            [2,6],
                            [5,9],
                            [10,10],                        
                        ],
                arr_pair_4_2: [
                            [2,2],
                            [11,3],
                            [5,4],
                            [6,7],
                            [9,9],
                            [3,10],                        
                        ], 
            },
            arr_pair_5: {
                arr_pair_5_1: [
                            [5,3],
                            [2,4],
                            [8,5],
                            [11,8],
                            [6,9],
                            [3,10],                        
                        ],
                arr_pair_5_2: [
                            [6,3],
                            [10,3],
                            [4,6],
                            [8,7],
                            [10,9],
                            [7,11],                        
                        ], 
            },                           
        }

        jatos.studySessionData.inputData.stimuli = {
            // practice: {
            //     practice:[
            //         'img/targets/BOSS/downsized/8ball.jpg',
            //         'img/targets/BOSS/downsized/accordion01.jpg',
            //         'img/targets/BOSS/downsized/aceofdiamond.jpg',
            //     ]
            // },
            schema_c: {
                schema_learning: [
                    'img/targets/BOSS/downsized/acorn.jpg',
                    'img/targets/BOSS/downsized/acousticguitar02.jpg',
                    'img/targets/BOSS/downsized/addressplate.jpg',
                    'img/targets/BOSS/downsized/africanelephant.jpg',
                    'img/targets/BOSS/downsized/aloe01.jpg',
                    'img/targets/BOSS/downsized/americangoldfinch.jpg',
                ],
                new_pa_learning: [
                    'img/targets/BOSS/downsized/anchor.jpg',
                    'img/targets/BOSS/downsized/ant.jpg',
                    'img/targets/BOSS/downsized/antlers.jpg',
                    'img/targets/BOSS/downsized/armchair02.jpg',
                    'img/targets/BOSS/downsized/artichoke01b.jpg',
                    'img/targets/BOSS/downsized/badmintonracket.jpg',
                ],
            },
            schema_ic: {
                schema_learning: [
                    'img/targets/BOSS/downsized/ballofstring.jpg',
                    'img/targets/BOSS/downsized/barbecuelighter.jpg',
                    'img/targets/BOSS/downsized/barnowl.jpg',
                    'img/targets/BOSS/downsized/barrel01.jpg',
                    'img/targets/BOSS/downsized/baseballglove.jpg',
                    'img/targets/BOSS/downsized/basketball01.jpg',
                ],
                new_pa_learning: [
                    'img/targets/BOSS/downsized/bassethound.jpg',
                    'img/targets/BOSS/downsized/battleaxe.jpg',
                    'img/targets/BOSS/downsized/beachpaddle01a.jpg',
                    'img/targets/BOSS/downsized/beachumbrella01.jpg',
                    'img/targets/BOSS/downsized/bed.jpg',
                    'img/targets/BOSS/downsized/beerbottle.jpg',
                ],
            },
            random_locations: {
                schema_learning: [
                    'img/targets/BOSS/downsized/belltower01.jpg',
                    'img/targets/BOSS/downsized/bench01.jpg',
                    'img/targets/BOSS/downsized/bicycle.jpg',
                    'img/targets/BOSS/downsized/bikepump01.jpg',
                    'img/targets/BOSS/downsized/birdhouse.jpg',
                    'img/targets/BOSS/downsized/birdnest.jpg',
                ],
                new_pa_learning: [
                    'img/targets/BOSS/downsized/blackbear.jpg',
                    'img/targets/BOSS/downsized/bluecheese.jpg',
                    'img/targets/BOSS/downsized/bolt01a.jpg',
                    'img/targets/BOSS/downsized/bookshelf.jpg',
                    'img/targets/BOSS/downsized/bottleofwhitewine.jpg',
                    'img/targets/BOSS/downsized/bow.jpg',
                ],
            },
            landmark_schema: {
                schema_learning: [
                    'img/targets/BOSS/downsized/bowlingball.jpg',
                    'img/targets/BOSS/downsized/bowlingpin.jpg',
                    'img/targets/BOSS/downsized/bowtie.jpg',
                    'img/targets/BOSS/downsized/boxingglove01.jpg',
                    'img/targets/BOSS/downsized/boxtruck.jpg',
                    'img/targets/BOSS/downsized/broadsword.jpg',
                ],
                new_pa_learning: [
                    'img/targets/BOSS/downsized/buffaloskull.jpg',
                    'img/targets/BOSS/downsized/bulldozer.jpg',
                    'img/targets/BOSS/downsized/bullet.jpg',
                    'img/targets/BOSS/downsized/bulletbelt.jpg',
                    'img/targets/BOSS/downsized/bun.jpg',
                    'img/targets/BOSS/downsized/butterfly.jpg',
                ],
            },
            no_schema: {
                schema_learning: [],
                new_pa_learning: [
                    'img/targets/BOSS/downsized/cactus.jpg',
                    'img/targets/BOSS/downsized/callbell.jpg',
                    'img/targets/BOSS/downsized/campfire.jpg',
                    'img/targets/BOSS/downsized/candelabra.jpg',
                    'img/targets/BOSS/downsized/candycane01a.jpg',
                    'img/targets/BOSS/downsized/car.jpg',
                ],
            }
        }            

        jatos.studySessionData.inputData.all_images = [
        'img/targets/BOSS/downsized/8ball.jpg',
        'img/targets/BOSS/downsized/accordion01.jpg',
        'img/targets/BOSS/downsized/aceofdiamond.jpg',
        'img/targets/BOSS/downsized/acorn.jpg',
        'img/targets/BOSS/downsized/acousticguitar02.jpg',
        'img/targets/BOSS/downsized/addressplate.jpg',
        'img/targets/BOSS/downsized/africanelephant.jpg',
        'img/targets/BOSS/downsized/aloe01.jpg',
        'img/targets/BOSS/downsized/americangoldfinch.jpg',
        'img/targets/BOSS/downsized/anchor.jpg',
        'img/targets/BOSS/downsized/ant.jpg',
        'img/targets/BOSS/downsized/antlers.jpg',
        'img/targets/BOSS/downsized/armchair02.jpg',
        'img/targets/BOSS/downsized/artichoke01b.jpg',
        'img/targets/BOSS/downsized/badmintonracket.jpg',
        'img/targets/BOSS/downsized/ballofstring.jpg',
        'img/targets/BOSS/downsized/barbecuelighter.jpg',
        'img/targets/BOSS/downsized/barnowl.jpg',
        'img/targets/BOSS/downsized/barrel01.jpg',
        'img/targets/BOSS/downsized/baseballglove.jpg',
        'img/targets/BOSS/downsized/basketball01.jpg',
        'img/targets/BOSS/downsized/bassethound.jpg',
        'img/targets/BOSS/downsized/battleaxe.jpg',
        'img/targets/BOSS/downsized/beachpaddle01a.jpg',
        'img/targets/BOSS/downsized/beachumbrella01.jpg',
        'img/targets/BOSS/downsized/bed.jpg',
        'img/targets/BOSS/downsized/beerbottle.jpg',
        'img/targets/BOSS/downsized/belltower01.jpg',
        'img/targets/BOSS/downsized/bench01.jpg',
        'img/targets/BOSS/downsized/bicycle.jpg',
        'img/targets/BOSS/downsized/bikepump01.jpg',
        'img/targets/BOSS/downsized/birdhouse.jpg',
        'img/targets/BOSS/downsized/birdnest.jpg',
        'img/targets/BOSS/downsized/blackbear.jpg',
        'img/targets/BOSS/downsized/bluecheese.jpg',
        'img/targets/BOSS/downsized/bolt01a.jpg',
        'img/targets/BOSS/downsized/bookshelf.jpg',
        'img/targets/BOSS/downsized/bottleofwhitewine.jpg',
        'img/targets/BOSS/downsized/bow.jpg',
        'img/targets/BOSS/downsized/bowlingball.jpg',
        'img/targets/BOSS/downsized/bowlingpin.jpg',
        'img/targets/BOSS/downsized/bowtie.jpg',
        'img/targets/BOSS/downsized/boxingglove01.jpg',
        'img/targets/BOSS/downsized/boxtruck.jpg',
        'img/targets/BOSS/downsized/broadsword.jpg',
        'img/targets/BOSS/downsized/buffaloskull.jpg',
        'img/targets/BOSS/downsized/bulldozer.jpg',
        'img/targets/BOSS/downsized/bullet.jpg',
        'img/targets/BOSS/downsized/bulletbelt.jpg',
        'img/targets/BOSS/downsized/bun.jpg',
        'img/targets/BOSS/downsized/butterfly.jpg',
        'img/targets/BOSS/downsized/cactus.jpg',
        'img/targets/BOSS/downsized/callbell.jpg',
        'img/targets/BOSS/downsized/campfire.jpg',
        'img/targets/BOSS/downsized/candelabra.jpg',
        'img/targets/BOSS/downsized/candycane01a.jpg',
        'img/targets/BOSS/downsized/car.jpg',
        'img/targets/BOSS/downsized/caribou02.jpg',
        'img/targets/BOSS/downsized/carsidemirror01.jpg',
        'img/targets/BOSS/downsized/cartonofeggs.jpg',
        'img/targets/BOSS/downsized/casabamelon.jpg',
        'img/targets/BOSS/downsized/castle.jpg',
        'img/targets/BOSS/downsized/cat.jpg',
        'img/targets/BOSS/downsized/centurionhelmet.jpg',
        'img/targets/BOSS/downsized/chainsaw.jpg',
        'img/targets/BOSS/downsized/chair.jpg',
        'img/targets/BOSS/downsized/chameleon.jpg',
        'img/targets/BOSS/downsized/chandelier.jpg',
        'img/targets/BOSS/downsized/cheetah.jpg',
        'img/targets/BOSS/downsized/cherrytomato01.jpg',
        'img/targets/BOSS/downsized/chessknight03a.jpg',
        'img/targets/BOSS/downsized/chimney.jpg',
        'img/targets/BOSS/downsized/chipmunk.jpg',
        'img/targets/BOSS/downsized/christmastree.jpg',
        'img/targets/BOSS/downsized/cinderblock.jpg',
        'img/targets/BOSS/downsized/clover.jpg',
        'img/targets/BOSS/downsized/clownfish.jpg',
        'img/targets/BOSS/downsized/coffeemaker.jpg',
        'img/targets/BOSS/downsized/cookingpot.jpg',
        'img/targets/BOSS/downsized/corn02.jpg',
        'img/targets/BOSS/downsized/cornet.jpg',
        ]

        let autoConditions = jatos.componentJsonInput.autoConditions
        let debugMode      = jatos.componentJsonInput.debugMode


        // Add the page about counterbalancing conditions
        var condition_options = ['cb1','cb2','cb3','cb4'];

        var condition_choice_page = {
            type: 'survey-multi-choice',
            questions: [
                {prompt: "Please choose", name: 'condition', options: condition_options, required:false}, 
            ],
        };   

        timeline.push(condition_choice_page);

        if (!autoConditions){

            var n_schema_c_ses_page = {
                type: 'html-slider-response',
                stimulus: '<p>Number of schema C sessions</p>',
                labels: ['1','2','3','4','5','6'],
                min: 1,
                max: 6,
                step: 1,
                slider_start: 1,
                prompt: "<p>Choose the number of schema C sessions </p>"
            };

            var n_schema_ic_ses_page = {
                type: 'html-slider-response',
                stimulus: '<p>Number of schema IC sessions</p>',
                labels: ['1','2','3','4','5','6'],
                min: 1,
                max: 6,
                step: 1,
                slider_start: 1,
                prompt: "<p>Choose the number of schema IC sessions </p>"
            };

            var n_trials_per_pa = {
                type: 'html-slider-response',
                stimulus: '<p>Number of trials per PA</p>',
                labels: ['2','3','4','5','6','7','8','9','10','11','12','13','14','15'],
                min: 2,
                max: 15,
                step: 1,
                slider_start: 4,
                prompt: "<p>Choose the number trials per PA </p>"
            };			

            var schema_display_duration_page = {
                type: 'html-slider-response',
                stimulus: '<p>How long to show the schema PAs before the trial?</p>',
                // labels: ['500','750','1000', '1250','1500', '1750','2000', '2250','2500', '2750','3000', '3250','3500', '3750','4000'],
                labels: ['500','1000','1500','2000','2500','3000','3500','4000','4500','5000','5500','6000'],
                min: 500,
                max: 6000,
                step: 250,
                slider_start: 2000,
                prompt: "<p>Choose how long the schema items get displayed ahead of trial</p>"
            };

            var response_window_duration_page = {
                type: 'html-slider-response',
                stimulus: '<p>Response Window duration</p>',
                // labels: ['500','750','1000', '1250','1500', '1750','2000', '2250','2500', '2750','3000', '3250','3500', '3750','4000'],
                labels: ['500','1000','1500','2000','2500','3000','3500','4000','4500','5000','5500','6000'],
                min: 500,
                max: 6000,
                step: 250,
                slider_start: 3000,
                prompt: "<p>Choose the duration of response window for each trial</p>"
            };

            var feedback_duration_page = {
                type: 'html-slider-response',
                stimulus: '<p>Feedback duration</p>',
                // labels: ['0','100','200','300','400','500','600','700','800','900','1000'],
                labels: ['250','500','750','1000','1250','1500','1750','2000','2250','2500','2750','3000'],
                min: 250,
                max: 3000,
                step: 250,
                slider_start: 2000,
                prompt: "<p>Choose the duration for the feedback</p>"
            };		
            
            var iti_duration_page = {
                type: 'html-slider-response',
                stimulus: '<p>ITI duration</p>',
                // labels: ['100','200','300','400','500','600','700','800','900','1000'],
                labels: ['0','250','500','750','1000','1250','1500','1750','2000','2250','2500','2750','3000'],
                min: 0,
                max: 3000,
                step: 250,
                slider_start: 0,
                prompt: "<p>Choose the duration for ITI</p>"
            };			

            // Add the page about counterbalancing conditions
            var condition_options = ['cb1','cb2','cb3','cb4'];

            var show_schema_pa_at_feedback_page = {
                type: 'survey-multi-choice',
                questions: [
                    {prompt: "At feedback, should the schema-PAs be displayed alongside the new PA that is being learned?", name: 'condition', options: ['yes','no'], required:false}, 
                ],
            }; 

            timeline.push(n_schema_c_ses_page);
            timeline.push(n_schema_ic_ses_page);
            timeline.push(n_trials_per_pa);
            timeline.push(schema_display_duration_page);
            timeline.push(response_window_duration_page);
            timeline.push(feedback_duration_page);
            timeline.push(iti_duration_page);
            timeline.push(show_schema_pa_at_feedback_page);

        } else {

            jatos.studySessionData.inputData.n_ses_per_condition = {
                practice: 1,
                schema_c: 3,
                schema_ic: 3,
                landmark_schema: 3,
                random_locations: 3,
                no_schema: 3,
            }

            jatos.studySessionData.inputData.n_trials_per_pa = {
                practice: 2,
                schema_c: 10,
                schema_ic: 10,
                landmark_schema: 10,
                random_locations: 10,
                no_schema: 10,
            }

            jatos.studySessionData.inputData.schema_display_duration = 2000
            jatos.studySessionData.inputData.response_window_duration     = 3000
            jatos.studySessionData.inputData.feedback_duration = 2000
            jatos.studySessionData.inputData.iti_duration      = 0    

            jatos.studySessionData.inputData.condition_to_run = 'cb3'

            jatos.studySessionData.inputData.show_schema_pa_at_feedback_page = false

        }

        // How long to show the prompt image
        jatos.studySessionData.inputData.image_pres_duration = 1000

        // If we're debugging, make everything shorter
        if (debugMode){

            jatos.studySessionData.inputData.image_pres_duration = 50

            jatos.studySessionData.inputData.n_ses_per_condition = {
                practice: 1,
                schema_c: 2,
                schema_ic: 2,
            }

            jatos.studySessionData.inputData.n_trials_per_pa = {
                practice: 2,
                schema_c: 2,
                schema_ic: 2,
            }

            jatos.studySessionData.inputData.schema_display_duration = 50
            jatos.studySessionData.inputData.response_window_duration     = 200
            jatos.studySessionData.inputData.feedback_duration = 20
            jatos.studySessionData.inputData.iti_duration      = 0    

            jatos.studySessionData.inputData.condition_to_run = 'cb3'

            jatos.studySessionData.inputData.show_schema_pa_at_feedback_page = false

        }

		jsPsych.init({
			
			timeline: timeline,

			on_finish: function(data) {

				// Record results
				var results = jsPsych.data.get().values();

                if (!autoConditions){
                    jatos.studySessionData.inputData.condition_to_run = results[0].response.condition

                    jatos.studySessionData.inputData.n_ses_per_condition = {
                        practice: 1,
                        schema_c: results[1].response,
                        schema_ic: results[2].response,
                    }

                    jatos.studySessionData.inputData.n_trials_per_pa = {
                        practice: 2,
                        schema_c: results[3].response,
                        schema_ic: results[3].response,
                    }


                    jatos.studySessionData.inputData.schema_display_duration = results[4].response
                    jatos.studySessionData.inputData.response_window_duration     = results[5].response
                    jatos.studySessionData.inputData.feedback_duration = results[6].response
                    jatos.studySessionData.inputData.iti_duration      = results[7].response 
                    debugger

                    results[8].response.condition == 'yes' ? jatos.studySessionData.inputData.show_schema_pa_at_feedback_page = true : jatos.studySessionData.inputData.show_schema_pa_at_feedback_page = false
                    // Which counterbalancing was chosen?
                    jatos.studySessionData.inputData.condition_to_run = results[0].response.condition

                }
                ////////////////////////////////////////////////////////////////////////////////
                // debugger
                let cond_to_run = {}
                cond_to_run = jatos.studySessionData.inputData.stimuli

                cond_to_run = {
                    landmark_schema: jatos.studySessionData.inputData.stimuli.landmark_schema
                }


                jatos.studySessionData.inputData.condition_coords = {}

                jatos.studySessionData.inputData.condition_coords = {

                    schema_c: {
                        schema_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_1.arr_pair_1_1,
                        new_pa_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_1.arr_pair_1_2,
                    },

                    schema_ic: {
                        schema_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_2.arr_pair_2_1,
                        new_pa_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_2.arr_pair_2_2,
                    },

                    random_locations: {
                        schema_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_3.arr_pair_3_1, 
                        new_pa_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_3.arr_pair_3_2,
                    },

                    landmark_schema: {
                        schema_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_4.arr_pair_4_1, 
                        new_pa_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_4.arr_pair_4_2,
                    },

                    no_schema: {
                        schema_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_5.arr_pair_5_1, 
                        new_pa_learning: jatos.studySessionData.inputData.arrangement_coords.arr_pair_5.arr_pair_5_2,
                    },                    
                }
                
                // Create the trials
                jatos.studySessionData.inputData.all_sessions = trial_creator2(cond_to_run)

                // Make JATOS remember that this session was run
                jatos.studySessionData.latestFinishedComponentId    = jatos.componentId;
                jatos.studySessionData.latestFinishedComponentPos   = jatos.componentPos;
                jatos.studySessionData.latestFinishedComponentTitle = jatos.componentProperties.title;

                jatos.submitResultData("[conditions_start---" + 
                JSON.stringify(jatos.studySessionData) + "---conditions_end]", function(){jatos.startComponentByPos(9)});

			} // on finish
		});     // jsPsych.init   

    }); // jatos on load

    </script>
</html>
