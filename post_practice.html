<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0">
    <title>Post practice</title>	
	<script src="jspsych-6.3.1/jspsych.js" ></script>
	<script src='./jspsych-6.3.1/plugins/jspsych-instructions.js'></script>
	<script src='./jspsych-6.3.1/plugins/jspsych-html-slider-response.js'></script>
	<script src='./jspsych-6.3.1/plugins/jspsych-html-button-response.js'></script>
	<script src="jatos.js"></script>
	<link rel="stylesheet" href="jspsych-6.3.1/css/jspsych.css" type="text/css"></link>
	<link rel="stylesheet" href="./extra_files/schema_online.css" type="text/css"></link>	
  </head>

  <body>
  <script>

		//start timeline
		jatos.onLoad(function() {
			
			let comp_to_start = []
		
			//make a timeline
			let timeline =[]; 

			let instructions_text = []

			instructions_text = '<p>Great! Those were the practice trials. If anything is still unclear, you can choose to re-read the instructions and re-do the practice trials.</p>' +
			'<p>Otherwise, please continue to the main experiment!</p>' +
			'<p><br>In the main experiment, you will learn locations of hidden pictures on 5 different boards, one after another.</p>' + 
			'<p>Each board will have 6 visible pictures and 6 hidden pictures</p>'

			// Give a choice to redo practice trials
			var instructions = {
				type: 'html-button-response',
				stimulus: instructions_text,
				choices: ['Repeat instructions and practice trials', 'Continue to the experiment!'],
			};

			timeline.push(instructions);

			jsPsych.init({
				
				timeline: timeline,

				on_finish: function(data) {

					// If it was post-practice, then see if they wanna redo practice
					if (jatos.studySessionData.inputData.curr_session == 1){
						
						var results = jsPsych.data.get().values()

						if (results[0].response == 0){
							comp_to_start = jatos.studySessionData.inputData.component_positions.instructions 

							// Reset the session counter
							jatos.studySessionData.inputData.curr_session = 0

						} else {
							comp_to_start = jatos.studySessionData.inputData.component_positions.break2
						}

					}

					// Make JATOS remember that this session was run
                    jatos.studySessionData.latestFinishedComponentId    = jatos.componentId;
                    jatos.studySessionData.latestFinishedComponentPos   = jatos.componentPos;
                    jatos.studySessionData.latestFinishedComponentTitle = jatos.componentProperties.title;

					jatos.submitResultData('[break_start_' + '---' + 
					JSON.stringify(jatos.studySessionData) +
					'---' + '_break_end]', 
					function(){jatos.startComponentByPos(comp_to_start)});

					// jsPsych.data.displayData();
				}
			});

		});


	</script>
</body>
</html>